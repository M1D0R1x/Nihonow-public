{% extends 'base.html' %}
{% block title %}NihonBot - Nihonow{% endblock %}
{% block content %}
<style>
    body { font-family: Arial, sans-serif; background: #fff5f5; }
    #chat-container { max-width: 600px; margin: 50px auto; padding: 20px; background: #fad0c4; border-radius: 15px; }
    #chat-box { height: 300px; overflow-y: auto; border: 2px solid #ff6f61; padding: 10px; background: #fff; }
    #user-input { width: 80%; padding: 10px; margin-top: 10px; border-radius: 10px; border: 2px solid #ff6f61; }
    #send-btn { padding: 10px 20px; background: #ff6f61; color: #fff; border: none; border-radius: 10px; cursor: pointer; }
    #send-btn:hover { background: #e65a50; }
</style>

<div id="chat-container">
    <h2 style="color: #ff6f61;">NihonBot</h2>
    <div id="chat-box"></div>
    <input type="text" id="user-input" placeholder="Ask about Japan, culture, or language...">
    <button id="send-btn">Send</button>
</div>

<script>
    const chatBox = document.getElementById('chat-box');
    const userInput = document.getElementById('user-input');
    const sendBtn = document.getElementById('send-btn');

    sendBtn.addEventListener('click', sendMessage);
    userInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') sendMessage();
    });

    function sendMessage() {
        const message = userInput.value.trim();
        if (!message) return;

        chatBox.innerHTML += `<p><strong>You:</strong> ${message}</p>`;
        chatBox.scrollTop = chatBox.scrollHeight;
        userInput.value = '';

        fetch('/chatbot/get_response/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
                'X-CSRFToken': '{{ csrf_token }}'
            },
            body: `message=${encodeURIComponent(message)}`
        })
        .then(response => response.json())
        .then(data => {
            chatBox.innerHTML += `<p><strong>NihonBot:</strong> ${data.response || data.error}</p>`;
            chatBox.scrollTop = chatBox.scrollHeight;
        })
        .catch(error => {
            chatBox.innerHTML += `<p><strong>NihonBot:</strong> Oops, something went wrong!</p>`;
            chatBox.scrollTop = chatBox.scrollHeight;
        });
    }
</script>
{% endblock %}